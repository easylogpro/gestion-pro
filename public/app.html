<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GESTION PRO - EasyLog Pro</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="bridge/bridge.css">
</head>
<body>
<link rel="stylesheet" href="bridge.css">
</head>
<body>
    <div class="app-container">
        <!-- ============================================
             SIDEBAR
             ============================================ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo" onclick="navigateTo('dashboard')">
                    <div class="logo-icon">üè¢</div>
                    <span class="logo-text">GESTION PRO</span>
                </a>
            </div>

            <nav class="sidebar-nav">
                <!-- Dashboard -->
                <div class="nav-section">
                    <div class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard')">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Dashboard</span>
                    </div>
                </div>

                <!-- Analyses -->
                <div class="nav-section">
                    <div class="nav-section-title">Analyses</div>
                    <div class="nav-item" data-page="visites" onclick="navigateTo('visites')">
                        <span class="nav-icon">üìÖ</span>
                        <span class="nav-text">Visites SSI/DSF</span>
                    </div>
                    <div class="nav-item" data-page="dsf" onclick="navigateTo('dsf')">
                        <span class="nav-icon">üìà</span>
                        <span class="nav-text">DSF Tracker</span>
                        <span class="nav-badge" id="badge-dsf">0</span>
                    </div>
                    <div class="nav-item" data-page="devis" onclick="navigateTo('devis')">
                        <span class="nav-icon">üìÑ</span>
                        <span class="nav-text">Devis</span>
                    </div>
                    <div class="nav-item" data-page="travaux" onclick="navigateTo('travaux')">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">Travaux</span>
                        <span class="nav-badge" id="badge-travaux">0</span>
                    </div>
                </div>

                <!-- Outils -->
                <div class="nav-section">
                    <div class="nav-section-title">Outils</div>
                    <div class="nav-item" data-page="searchssi" onclick="navigateTo('searchssi')">
                        <span class="nav-icon">üîç</span>
                        <span class="nav-text">Recherche Client</span>
                    </div>
                    <div class="nav-item" data-page="produits" onclick="navigateTo('produits')">
                        <span class="nav-icon">üì¶</span>
                        <span class="nav-text">Recherche R√©f Produit</span>
                    </div>
                    <div class="nav-item" data-page="sav" onclick="navigateTo('sav')">
                        <span class="nav-icon">üîß</span>
                        <span class="nav-text">SAV</span>
                        <span class="nav-badge" id="badge-sav" style="display:none;">0</span>
                    </div>
                </div>

                <!-- Syst√®me -->
                <div class="nav-section">
                    <div class="nav-section-title">Syst√®me</div>
                    <div class="nav-item" data-page="archives" onclick="navigateTo('archives')">
                        <span class="nav-icon">üóÑÔ∏è</span>
                        <span class="nav-text">Archives</span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="data-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="statusText">Aucune donn√©e</span>
                </div>
            </div>
        </aside>

        <!-- ============================================
             MAIN CONTENT
             ============================================ -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-title">
                    <h1 id="pageTitle">üìä Dashboard</h1>
                    <div class="header-week" id="headerWeek">Semaine 51 - 2025</div>
                </div>
                <div class="header-actions">
                    <button class="btn-header btn-import" onclick="document.getElementById('fileInput').click()">
                        <span>üì•</span>
                        <span>Importer Excel</span>
                    </button>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                
                <!-- ============================================
                     PAGE: DASHBOARD
                     ============================================ -->
                <div id="page-dashboard" class="page active">
                    
                    <!-- √âtat initial: Import -->
                    <div id="importZone" class="import-zone">
                        <div class="import-card" id="importCard">
                            <div class="import-icon">üìÅ</div>
                            <h2>Importer vos donn√©es</h2>
                            <p>Glissez votre fichier Excel ici ou cliquez pour s√©lectionner</p>
                            <p class="formats">Formats accept√©s: .xlsx, .xls</p>
                        </div>
                        
                        <div class="import-options">
                            <div class="import-option" onclick="document.getElementById('fileInput').click()">
                                <span>üìä</span>
                                <span>Fichier Excel unique</span>
                            </div>
                            <div class="import-option access" onclick="connectBridge()" id="bridgeConnectOption">
                                <span>üîó</span>
                                <span>Connexion Access (Bridge)</span>
                            </div>
                        </div>

                        <div class="import-status" id="importStatus">
                            <p style="color: var(--text-secondary); margin-bottom: 16px;">Feuilles charg√©es :</p>
                            <div class="sheets-loaded" id="sheetsLoaded"></div>
                        </div>
                    </div>

                    <!-- Dashboard (affich√© apr√®s import) -->
                    <div id="dashboardContent" class="dashboard-grid hidden">
                        
                        <!-- FILTRE SECTEUR EN HAUT -->
                        <div class="dashboard-filter">
                            <label>üéØ Filtrer par secteur :</label>
                            <select id="dashboardSectorFilter" onchange="DASHBOARD.filterBySector()">
                                <option value="TOUS">Tous les secteurs</option>
                                <option value="S1">üîµ Secteur S1</option>
                                <option value="S2">üü¢ Secteur S2</option>
                                <option value="S3">üî¥ Secteur S3</option>
                                <option value="AUTRES">‚ö™ Autres</option>
                            </select>
                            <div style="margin-left: auto; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 0.85em; color: var(--text-muted);">Semaine</span>
                                <span id="dashboardWeekNum" style="font-weight: 700; color: var(--emerald); font-size: 1.1em;">--</span>
                                <span id="dashboardVisitType" style="padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; background: var(--emerald); color: white;">V1/V2</span>
                            </div>
                        </div>

                        <!-- EN-T√äTES SECTEURS -->
                        <div class="dashboard-sector-headers">
                            <div class="sector-header-label"></div>
                            <div class="sector-header-col s1">üîµ S1</div>
                            <div class="sector-header-col s2">üü¢ S2</div>
                            <div class="sector-header-col s3">üî¥ S3</div>
                            <div class="sector-header-col autres">‚ö™ AUTRES</div>
                        </div>

                        <!-- LIGNE SSI -->
                        <div class="dashboard-row">
                            <div class="dashboard-row-label">
                                <span class="row-icon">üîß</span>
                                <span class="row-title">Visites SSI</span>
                                <span class="row-subtitle" id="ssiObjectifInfo">Obj: --/sem</span>
                            </div>
                            <div class="dashboard-row-content">
                                <!-- S1 -->
                                <div class="dashboard-cell s1">
                                    <div class="cell-header">
                                        <span id="ssiS1Sites">0</span> sites
                                    </div>
                                    <div class="cell-stats">
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V1</span>
                                            <span class="cell-stat-value" id="ssiS1V1">0</span>
                                            <span class="cell-stat-pct" id="ssiS1V1Pct">0%</span>
                                        </div>
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V2</span>
                                            <span class="cell-stat-value" id="ssiS1V2">0</span>
                                            <span class="cell-stat-pct" id="ssiS1V2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="ssiS1Progress" style="width:0%"></div></div>
                                    <div class="cell-objectif" id="ssiS1Objectif">~0/sem</div>
                                </div>
                                <!-- S2 -->
                                <div class="dashboard-cell s2">
                                    <div class="cell-header">
                                        <span id="ssiS2Sites">0</span> sites
                                    </div>
                                    <div class="cell-stats">
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V1</span>
                                            <span class="cell-stat-value" id="ssiS2V1">0</span>
                                            <span class="cell-stat-pct" id="ssiS2V1Pct">0%</span>
                                        </div>
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V2</span>
                                            <span class="cell-stat-value" id="ssiS2V2">0</span>
                                            <span class="cell-stat-pct" id="ssiS2V2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="ssiS2Progress" style="width:0%"></div></div>
                                    <div class="cell-objectif" id="ssiS2Objectif">~0/sem</div>
                                </div>
                                <!-- S3 -->
                                <div class="dashboard-cell s3">
                                    <div class="cell-header">
                                        <span id="ssiS3Sites">0</span> sites
                                    </div>
                                    <div class="cell-stats">
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V1</span>
                                            <span class="cell-stat-value" id="ssiS3V1">0</span>
                                            <span class="cell-stat-pct" id="ssiS3V1Pct">0%</span>
                                        </div>
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V2</span>
                                            <span class="cell-stat-value" id="ssiS3V2">0</span>
                                            <span class="cell-stat-pct" id="ssiS3V2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="ssiS3Progress" style="width:0%"></div></div>
                                    <div class="cell-objectif" id="ssiS3Objectif">~0/sem</div>
                                </div>
                                <!-- AUTRES -->
                                <div class="dashboard-cell autres">
                                    <div class="cell-header">
                                        <span id="ssiAutresSites">0</span> sites
                                    </div>
                                    <div class="cell-stats">
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V1</span>
                                            <span class="cell-stat-value" id="ssiAutresV1">0</span>
                                            <span class="cell-stat-pct" id="ssiAutresV1Pct">0%</span>
                                        </div>
                                        <div class="cell-stat">
                                            <span class="cell-stat-label">V2</span>
                                            <span class="cell-stat-value" id="ssiAutresV2">0</span>
                                            <span class="cell-stat-pct" id="ssiAutresV2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="ssiAutresProgress" style="width:0%"></div></div>
                                    <div class="cell-objectif" id="ssiAutresObjectif">~0/sem</div>
                                </div>
                            </div>
                        </div>

                        <!-- LIGNE DSF VISITES -->
                        <div class="dashboard-row">
                            <div class="dashboard-row-label">
                                <span class="row-icon">üî•</span>
                                <span class="row-title">Visites DSF</span>
                            </div>
                            <div class="dashboard-row-content">
                                <!-- S1 -->
                                <div class="dashboard-cell s1">
                                    <div class="cell-header"><span id="dsfS1Sites">0</span> sites</div>
                                    <div class="cell-stats">
                                        <div class="cell-stat single">
                                            <span class="cell-stat-label">Restantes</span>
                                            <span class="cell-stat-value large" id="dsfS1Rest">0</span>
                                            <span class="cell-stat-pct" id="dsfS1Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="dsfS1Progress" style="width:0%"></div></div>
                                </div>
                                <!-- S2 -->
                                <div class="dashboard-cell s2">
                                    <div class="cell-header"><span id="dsfS2Sites">0</span> sites</div>
                                    <div class="cell-stats">
                                        <div class="cell-stat single">
                                            <span class="cell-stat-label">Restantes</span>
                                            <span class="cell-stat-value large" id="dsfS2Rest">0</span>
                                            <span class="cell-stat-pct" id="dsfS2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="dsfS2Progress" style="width:0%"></div></div>
                                </div>
                                <!-- S3 -->
                                <div class="dashboard-cell s3">
                                    <div class="cell-header"><span id="dsfS3Sites">0</span> sites</div>
                                    <div class="cell-stats">
                                        <div class="cell-stat single">
                                            <span class="cell-stat-label">Restantes</span>
                                            <span class="cell-stat-value large" id="dsfS3Rest">0</span>
                                            <span class="cell-stat-pct" id="dsfS3Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="dsfS3Progress" style="width:0%"></div></div>
                                </div>
                                <!-- AUTRES -->
                                <div class="dashboard-cell autres">
                                    <div class="cell-header"><span id="dsfAutresSites">0</span> sites</div>
                                    <div class="cell-stats">
                                        <div class="cell-stat single">
                                            <span class="cell-stat-label">Restantes</span>
                                            <span class="cell-stat-value large" id="dsfAutresRest">0</span>
                                            <span class="cell-stat-pct" id="dsfAutresPct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar small"><div class="progress-fill" id="dsfAutresProgress" style="width:0%"></div></div>
                                </div>
                            </div>
                        </div>

                        <!-- LIGNE DSF NON CLOTURES -->
                        <div class="dashboard-row">
                            <div class="dashboard-row-label">
                                <span class="row-icon">üìã</span>
                                <span class="row-title">DSF Non Cl√¥t.</span>
                            </div>
                            <div class="dashboard-row-content">
                                <!-- S1 -->
                                <div class="dashboard-cell s1 clickable-cell">
                                    <div class="dsf-mini-stats">
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('cloture','S1')">
                                            <span class="dsf-mini-value" id="dsfS1Cloture">0</span>
                                            <span class="dsf-mini-label">CLOT</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('planif','S1')">
                                            <span class="dsf-mini-value" id="dsfS1Planif">0</span>
                                            <span class="dsf-mini-label">PLANIF</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('resp','S1')">
                                            <span class="dsf-mini-value" id="dsfS1Resp">0</span>
                                            <span class="dsf-mini-label">RESP</span>
                                        </div>
                                    </div>
                                    <div class="dsf-total">Total: <span id="dsfS1Total">0</span></div>
                                </div>
                                <!-- S2 -->
                                <div class="dashboard-cell s2 clickable-cell">
                                    <div class="dsf-mini-stats">
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('cloture','S2')">
                                            <span class="dsf-mini-value" id="dsfS2Cloture">0</span>
                                            <span class="dsf-mini-label">CLOT</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('planif','S2')">
                                            <span class="dsf-mini-value" id="dsfS2Planif">0</span>
                                            <span class="dsf-mini-label">PLANIF</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('resp','S2')">
                                            <span class="dsf-mini-value" id="dsfS2Resp">0</span>
                                            <span class="dsf-mini-label">RESP</span>
                                        </div>
                                    </div>
                                    <div class="dsf-total">Total: <span id="dsfS2Total">0</span></div>
                                </div>
                                <!-- S3 -->
                                <div class="dashboard-cell s3 clickable-cell">
                                    <div class="dsf-mini-stats">
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('cloture','S3')">
                                            <span class="dsf-mini-value" id="dsfS3Cloture">0</span>
                                            <span class="dsf-mini-label">CLOT</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('planif','S3')">
                                            <span class="dsf-mini-value" id="dsfS3Planif">0</span>
                                            <span class="dsf-mini-label">PLANIF</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('resp','S3')">
                                            <span class="dsf-mini-value" id="dsfS3Resp">0</span>
                                            <span class="dsf-mini-label">RESP</span>
                                        </div>
                                    </div>
                                    <div class="dsf-total">Total: <span id="dsfS3Total">0</span></div>
                                </div>
                                <!-- AUTRES -->
                                <div class="dashboard-cell autres clickable-cell">
                                    <div class="dsf-mini-stats">
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('cloture','AUTRES')">
                                            <span class="dsf-mini-value" id="dsfAutresCloture">0</span>
                                            <span class="dsf-mini-label">CLOT</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('planif','AUTRES')">
                                            <span class="dsf-mini-value" id="dsfAutresPlanif">0</span>
                                            <span class="dsf-mini-label">PLANIF</span>
                                        </div>
                                        <div class="dsf-mini-item clickable" onclick="openDSFModal('resp','AUTRES')">
                                            <span class="dsf-mini-value" id="dsfAutresResp">0</span>
                                            <span class="dsf-mini-label">RESP</span>
                                        </div>
                                    </div>
                                    <div class="dsf-total">Total: <span id="dsfAutresTotal">0</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- LIGNE TRAVAUX -->
                        <div class="dashboard-row">
                            <div class="dashboard-row-label">
                                <span class="row-icon">üõ†Ô∏è</span>
                                <span class="row-title">Travaux</span>
                            </div>
                            <div class="dashboard-row-content">
                                <!-- S1 -->
                                <div class="dashboard-cell s1 clickable-cell" onclick="openTravauxRestantsModal('S1')">
                                    <div class="travaux-count" id="travauxS1Count">0</div>
                                    <div class="travaux-label">PL TECH vide</div>
                                </div>
                                <!-- S2 -->
                                <div class="dashboard-cell s2 clickable-cell" onclick="openTravauxRestantsModal('S2')">
                                    <div class="travaux-count" id="travauxS2Count">0</div>
                                    <div class="travaux-label">PL TECH vide</div>
                                </div>
                                <!-- S3 -->
                                <div class="dashboard-cell s3 clickable-cell" onclick="openTravauxRestantsModal('S3')">
                                    <div class="travaux-count" id="travauxS3Count">0</div>
                                    <div class="travaux-label">PL TECH vide</div>
                                </div>
                                <!-- AUTRES -->
                                <div class="dashboard-cell autres clickable-cell" onclick="openTravauxRestantsModal('AUTRES')">
                                    <div class="travaux-count" id="travauxAutresCount">0</div>
                                    <div class="travaux-label">PL TECH vide</div>
                                </div>
                            </div>
                        </div>

                        <!-- LIGNE SAV -->
                        <div class="dashboard-row">
                            <div class="dashboard-row-label">
                                <span class="row-icon">üõéÔ∏è</span>
                                <span class="row-title">SAV du Jour</span>
                            </div>
                            <div class="dashboard-row-content">
                                <!-- S1 -->
                                <div class="dashboard-cell s1">
                                    <div class="sav-mini-stats">
                                        <div class="sav-mini-item urgent">
                                            <span class="sav-mini-value" id="savS1Urgent">0</span>
                                            <span class="sav-mini-label">üî¥</span>
                                        </div>
                                        <div class="sav-mini-item h48">
                                            <span class="sav-mini-value" id="savS1H48">0</span>
                                            <span class="sav-mini-label">üü†</span>
                                        </div>
                                        <div class="sav-mini-item rdv">
                                            <span class="sav-mini-value" id="savS1Rdv">0</span>
                                            <span class="sav-mini-label">üü¢</span>
                                        </div>
                                        <div class="sav-mini-item nonplan">
                                            <span class="sav-mini-value" id="savS1NonPlan">0</span>
                                            <span class="sav-mini-label">‚ö™</span>
                                        </div>
                                    </div>
                                    <div class="sav-total">Total: <span id="savS1Total">0</span></div>
                                </div>
                                <!-- S2 -->
                                <div class="dashboard-cell s2">
                                    <div class="sav-mini-stats">
                                        <div class="sav-mini-item urgent">
                                            <span class="sav-mini-value" id="savS2Urgent">0</span>
                                            <span class="sav-mini-label">üî¥</span>
                                        </div>
                                        <div class="sav-mini-item h48">
                                            <span class="sav-mini-value" id="savS2H48">0</span>
                                            <span class="sav-mini-label">üü†</span>
                                        </div>
                                        <div class="sav-mini-item rdv">
                                            <span class="sav-mini-value" id="savS2Rdv">0</span>
                                            <span class="sav-mini-label">üü¢</span>
                                        </div>
                                        <div class="sav-mini-item nonplan">
                                            <span class="sav-mini-value" id="savS2NonPlan">0</span>
                                            <span class="sav-mini-label">‚ö™</span>
                                        </div>
                                    </div>
                                    <div class="sav-total">Total: <span id="savS2Total">0</span></div>
                                </div>
                                <!-- S3 -->
                                <div class="dashboard-cell s3">
                                    <div class="sav-mini-stats">
                                        <div class="sav-mini-item urgent">
                                            <span class="sav-mini-value" id="savS3Urgent">0</span>
                                            <span class="sav-mini-label">üî¥</span>
                                        </div>
                                        <div class="sav-mini-item h48">
                                            <span class="sav-mini-value" id="savS3H48">0</span>
                                            <span class="sav-mini-label">üü†</span>
                                        </div>
                                        <div class="sav-mini-item rdv">
                                            <span class="sav-mini-value" id="savS3Rdv">0</span>
                                            <span class="sav-mini-label">üü¢</span>
                                        </div>
                                        <div class="sav-mini-item nonplan">
                                            <span class="sav-mini-value" id="savS3NonPlan">0</span>
                                            <span class="sav-mini-label">‚ö™</span>
                                        </div>
                                    </div>
                                    <div class="sav-total">Total: <span id="savS3Total">0</span></div>
                                </div>
                                <!-- AUTRES -->
                                <div class="dashboard-cell autres">
                                    <div class="sav-mini-stats">
                                        <div class="sav-mini-item urgent">
                                            <span class="sav-mini-value" id="savAutresUrgent">0</span>
                                            <span class="sav-mini-label">üî¥</span>
                                        </div>
                                        <div class="sav-mini-item h48">
                                            <span class="sav-mini-value" id="savAutresH48">0</span>
                                            <span class="sav-mini-label">üü†</span>
                                        </div>
                                        <div class="sav-mini-item rdv">
                                            <span class="sav-mini-value" id="savAutresRdv">0</span>
                                            <span class="sav-mini-label">üü¢</span>
                                        </div>
                                        <div class="sav-mini-item nonplan">
                                            <span class="sav-mini-value" id="savAutresNonPlan">0</span>
                                            <span class="sav-mini-label">‚ö™</span>
                                        </div>
                                    </div>
                                    <div class="sav-total">Total: <span id="savAutresTotal">0</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- GRAPHIQUE √âVOLUTION HEBDOMADAIRE -->
                        <div class="card-section chart-section">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span>üìä</span>
                                    √âvolution hebdomadaire
                                </h3>
                                <select id="chartSectorFilter" onchange="DASHBOARD.updateChart()" style="padding: 8px 12px; border-radius: var(--radius-md); border: 1px solid var(--border-card); background: var(--bg-elevated); font-size: 0.85em;">
                                    <option value="TOUS">Tous les secteurs</option>
                                    <option value="S1">üîµ S1</option>
                                    <option value="S2">üü¢ S2</option>
                                    <option value="S3">üî¥ S3</option>
                                    <option value="AUTRES">‚ö™ Autres</option>
                                </select>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="evolutionChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- KPIs EN BAS -->
                        <div class="kpi-row">
                            <div class="kpi-card ca" onclick="navigateTo('travaux')">
                                <div class="kpi-header">
                                    <div class="kpi-icon">üí∞</div>
                                    <span class="kpi-trend up" id="kpiCaTrend">+12%</span>
                                </div>
                                <div class="kpi-value" id="kpiCa">0 ‚Ç¨</div>
                                <div class="kpi-label">Chiffre d'affaires</div>
                            </div>

                            <div class="kpi-card travaux" onclick="navigateTo('travaux')">
                                <div class="kpi-header">
                                    <div class="kpi-icon">üìã</div>
                                </div>
                                <div class="kpi-value" id="kpiTravaux">0</div>
                                <div class="kpi-label">Travaux en cours</div>
                            </div>

                            <div class="kpi-card devis" onclick="navigateTo('devis')">
                                <div class="kpi-header">
                                    <div class="kpi-icon">üìÑ</div>
                                </div>
                                <div class="kpi-value" id="kpiDevis">0</div>
                                <div class="kpi-label">Devis en attente</div>
                            </div>

                            <div class="kpi-card visites" onclick="navigateTo('visites')">
                                <div class="kpi-header">
                                    <div class="kpi-icon">üìÖ</div>
                                </div>
                                <div class="kpi-value" id="kpiVisites">0</div>
                                <div class="kpi-label">Visites restantes</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ============================================
                     PAGE: TRAVAUX (Module complet)
                     ============================================ -->
                <div id="page-travaux" class="page">
                    
                    <!-- Filtres Travaux -->
                    <div class="travaux-filters">
                        <div class="filters-grid">
                            <div class="filter-group">
                                <label>üë§ Technicien INFO</label>
                                <select id="travauxTechFilter">
                                    <option value="TOUS">Tous les techniciens</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>‚úçÔ∏è R√©dacteur Devis</label>
                                <select id="travauxRedacteurFilter">
                                    <option value="TOUS">Tous les r√©dacteurs</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>üìç Secteur</label>
                                <select id="travauxSecteurFilter">
                                    <option value="TOUS">Tous les secteurs</option>
                                    <option value="S1">Secteur S1</option>
                                    <option value="S2">Secteur S2</option>
                                    <option value="S3">Secteur S3</option>
                                    <option value="AUTRES">Autres</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>üè¢ Sous-traitant</label>
                                <select id="travauxSttFilter">
                                    <option value="TOUS">Tous</option>
                                    <option value="AVEC">Avec STT</option>
                                    <option value="SANS">Sans STT</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>üìÖ Ann√©e</label>
                                <select id="travauxAnneeFilter">
                                    <option value="TOUS">Toutes</option>
                                </select>
                            </div>
                        </div>
                        <div class="filters-actions">
                            <button class="btn-action email-redacteur" id="btnEmailRedacteur" onclick="TRAVAUX.sendEmailRedacteur()">
                                üìß Email R√©dacteur
                            </button>
                            <button class="btn-action email-stt" id="btnEmailSttList" onclick="TRAVAUX.openSttModal()">
                                üìß Emails STT
                            </button>
                        </div>
                    </div>

                    <!-- Stats Travaux -->
                    <div class="travaux-stats">
                        <div class="stat-card-travaux ca" onclick="TRAVAUX.openModalCA()">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <div class="stat-value" id="travauxCA">0 ‚Ç¨</div>
                                <div class="stat-label">Total CA</div>
                            </div>
                        </div>
                        <div class="stat-card-travaux secteur" onclick="TRAVAUX.openModalSecteur()">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-info">
                                <div class="stat-value" id="travauxNbSecteur">0</div>
                                <div class="stat-label">Travaux (Secteur)</div>
                            </div>
                        </div>
                        <div class="stat-card-travaux tech" onclick="TRAVAUX.openModalTechnicien()">
                            <div class="stat-icon">üë∑</div>
                            <div class="stat-info">
                                <div class="stat-value" id="travauxNbTech">0</div>
                                <div class="stat-label">Travaux (Tech)</div>
                            </div>
                        </div>
                        <div class="stat-card-travaux stt" onclick="TRAVAUX.openModalStatsStt()">
                            <div class="stat-icon">üè¢</div>
                            <div class="stat-info">
                                <div class="stat-value" id="travauxNbStt">0</div>
                                <div class="stat-label">Travaux STT</div>
                            </div>
                        </div>
                        <div class="stat-card-travaux budget" onclick="TRAVAUX.openModalBudgetStt()">
                            <div class="stat-icon">üíµ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="travauxBudgetStt">0 ‚Ç¨</div>
                                <div class="stat-label">Budget STT</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tableau Travaux -->
                    <div class="travaux-table-container">
                        <div class="table-header-info">
                            <span id="travauxCount">0 travaux</span>
                            <div class="table-legend">
                                <span class="legend-item stt">üü° Avec sous-traitant</span>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="travaux-table" id="travauxTable">
                                <thead id="travauxTableHead"></thead>
                                <tbody id="travauxTableBody"></tbody>
                            </table>
                        </div>
                        <div class="empty-state-travaux" id="travauxEmptyState">
                            <div class="empty-icon">üìã</div>
                            <h3>Aucune donn√©e</h3>
                            <p>Importez un fichier Excel avec la feuille TRAVAUX</p>
                        </div>
                    </div>

                </div>

                <!-- Modal D√©tail Client Travaux -->
                <div id="travauxDetailModal" class="modal-overlay">
                    <div class="modal-container large">
                        <button class="modal-close" onclick="TRAVAUX.closeDetail()">√ó</button>
                        <h2 class="modal-title">üìã Fiche Client D√©taill√©e</h2>
                        <div class="modal-nav">
                            <button class="btn-nav" id="travauxPrevBtn" onclick="TRAVAUX.navigate(-1)">‚Üê Pr√©c√©dent</button>
                            <span class="nav-counter" id="travauxNavCounter">1 / 1</span>
                            <button class="btn-nav" id="travauxNextBtn" onclick="TRAVAUX.navigate(1)">Suivant ‚Üí</button>
                            <button class="btn-action email-stt" id="travauxEmailSttBtn" onclick="TRAVAUX.sendEmailSttSingle()" style="display: none;">üìß Email STT</button>
                        </div>
                        <div class="modal-body" id="travauxDetailContent"></div>
                    </div>
                </div>

                <!-- Modal Emails STT -->
                <div id="travauxSttModal" class="modal-overlay">
                    <div class="modal-container large">
                        <button class="modal-close" onclick="TRAVAUX.closeSttModal()">√ó</button>
                        <h2 class="modal-title">üìß Gestion Emails Sous-traitants</h2>
                        <div class="stt-tabs-container">
                            <button class="stt-tab-btn active" data-tab="aPlanifier" onclick="TRAVAUX.switchSttTab('aPlanifier')">üìÖ √Ä Planifier</button>
                            <button class="stt-tab-btn" data-tab="planifies" onclick="TRAVAUX.switchSttTab('planifies')">‚úÖ D√©j√† Planifi√©s</button>
                        </div>
                        <div class="modal-body" id="travauxSttContent"></div>
                        <div class="modal-footer">
                            <button class="btn-action primary" onclick="TRAVAUX.sendSelectedSttEmails()">üìß Envoyer aux s√©lectionn√©s</button>
                        </div>
                    </div>
                </div>

                <!-- Modal Stats (CA, Secteur, Technicien, Budget STT) -->
                <div id="travauxStatsModal" class="modal-overlay">
                    <div class="modal-container">
                        <button class="modal-close" onclick="TRAVAUX.closeStatsModal()">√ó</button>
                        <h2 class="modal-title" id="travauxStatsModalTitle">üìä Statistiques</h2>
                        <div class="modal-body" id="travauxStatsContent"></div>
                        <div class="stats-total" id="travauxStatsTotal"></div>
                    </div>
                </div>

                <!-- ============================================
                     PAGE: DEVIS (Module complet)
                     ============================================ -->
                <div id="page-devis" class="page">
                    
                    <!-- Recherche Devis - IDENTIQUE AU FICHIER ORIGINAL -->
                    <div class="devis-search-section">
                        <div class="search-grid">
                            <div class="search-field">
                                <label>üîç Recherche par N¬∞ Client</label>
                                <input type="text" id="devisSearchClient" placeholder="Entrez le num√©ro du client...">
                            </div>
                            <div class="search-field">
                                <label>üìÑ Recherche par N¬∞ Devis</label>
                                <input type="text" id="devisSearchDevis" placeholder="Entrez le num√©ro de devis...">
                            </div>
                            <div class="search-field">
                                <label>‚úçÔ∏è Recherche par R√©dacteur</label>
                                <input type="text" id="devisSearchRedacteur" placeholder="Entrez le nom du r√©dacteur...">
                            </div>
                        </div>
                    </div>

                    <!-- Stats Devis - 3 colonnes IDENTIQUE AU FICHIER ORIGINAL -->
                    <div class="synthese-contrat-section" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <!-- Synth√®se par Ann√©e - Couleur violet/bleu -->
                        <div class="synthese-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white;">
                            <div class="synthese-title" style="font-size: 18px; font-weight: 700; margin-bottom: 15px; text-align: center;">üìä Synth√®se par Ann√©e</div>
                            <div class="synthese-content" id="devisSyntheseContent" style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">Chargez un fichier pour voir la synth√®se</div>
                            </div>
                        </div>
                        
                        <!-- Synth√®se STT - Couleur rose/rouge -->
                        <div class="stt-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 20px; border-radius: 10px; color: white;">
                            <div class="stt-title" style="font-size: 18px; font-weight: 700; margin-bottom: 15px; text-align: center;">üè¢ Synth√®se STT</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 12px; font-weight: 600; margin-bottom: 5px; opacity: 0.9;">Budget Total</div>
                                    <div style="font-size: 20px; font-weight: 700;" id="devisTotalBudgetSTT">-- ‚Ç¨</div>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 12px; font-weight: 600; margin-bottom: 5px; opacity: 0.9;">Nombre STT</div>
                                    <div style="font-size: 20px; font-weight: 700;" id="devisCountSTT">0</div>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                <div style="font-size: 12px; font-weight: 600; margin-bottom: 8px; opacity: 0.9; text-align: center;">Budget par Ann√©e (Tous STT)</div>
                                <div id="devisBudgetParAnneeSTT" style="display: flex; flex-direction: column; gap: 6px;">
                                    <div style="text-align: center; color: rgba(255,255,255,0.7); font-size: 12px;">Chargez un fichier</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <select class="stt-dropdown" id="devisSttSelect" style="width: 100%; padding: 10px; margin-bottom: 15px; border: none; border-radius: 6px; background: rgba(255, 255, 255, 0.9); color: #333; font-weight: 600; cursor: pointer;">
                                        <option value="">S√©lectionnez un STT...</option>
                                    </select>
                                </div>
                                <div class="stt-content" id="devisSttContent">
                                    <div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px; font-size: 14px;">S√©lectionnez un STT</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contrat SSI - Couleur violet -->
                        <div class="contrat-box" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); padding: 20px; border-radius: 10px; color: white;">
                            <div class="contrat-title" style="font-size: 18px; font-weight: 700; margin-bottom: 15px; text-align: center;">üíº Contrat SSI</div>
                            <div class="contrat-content" style="display: flex; flex-direction: column; gap: 15px;">
                                <div class="contrat-item" style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 6px;">
                                    <div class="contrat-label" style="font-size: 12px; font-weight: 600; margin-bottom: 8px; opacity: 0.9;">Valeur du contrat</div>
                                    <div class="contrat-value" style="font-size: 24px; font-weight: 700;" id="devisValeurContrat">-- ‚Ç¨</div>
                                </div>
                                <div class="contrat-item" style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 6px;">
                                    <div class="contrat-label" style="font-size: 12px; font-weight: 600; margin-bottom: 8px; opacity: 0.9;">Taux horaire</div>
                                    <div class="contrat-value" style="font-size: 24px; font-weight: 700;" id="devisTauxHoraire">-- ‚Ç¨</div>
                                    <div class="contrat-value-small" style="font-size: 16px; font-weight: 600; margin-top: 5px; opacity: 0.95;" id="devisPourcentageTaux">--% du contrat</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section R√©sultats Devis - STYLE IDENTIQUE AU FICHIER ORIGINAL -->
                    <div class="devis-list-container" id="devisResultsSection" style="display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px;">
                        <div class="results-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
                            <span id="devisResultsCount" style="color: #667eea; font-weight: 600; font-size: 18px;">0 devis trouv√©s</span>
                        </div>
                        <div class="devis-list" id="devisDevisList" style="display: grid; gap: 15px;"></div>
                    </div>

                </div>

                <!-- Modal D√©tail Devis - IDENTIQUE AU FICHIER ORIGINAL -->
                <div id="devisDetailModal" class="modal-overlay">
                    <div class="modal-container large">
                        <div class="modal-header-devis" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 25px 30px; border-radius: var(--radius-lg) var(--radius-lg) 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h2 id="devisModalTitle" style="font-size: 1.4em; margin: 0;">D√©tails du Devis</h2>
                            <div class="nav-buttons" style="display: flex; gap: 10px; align-items: center;">
                                <button class="nav-btn" id="devisPrevBtn" onclick="DEVIS.navigate(-1)" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">‚Üê</button>
                                <span class="nav-info" id="devisNavInfo" style="color: white; font-size: 0.9em; font-weight: 600;">1/1</span>
                                <button class="nav-btn" id="devisNextBtn" onclick="DEVIS.navigate(1)" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">‚Üí</button>
                                <button class="close-btn" onclick="DEVIS.closeDetail()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 28px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 10px;">√ó</button>
                            </div>
                        </div>
                        <div class="modal-body" id="devisModalBody" style="padding: 30px;"></div>
                    </div>
                </div>

                <!-- ============================================
                     PAGE: VISITES (Module complet)
                     ============================================ -->
                <div id="page-visites" class="page">
                    
                    <!-- En-t√™te Visites -->
                    <div class="visites-header">
                        <div class="week-banner">
                            <div class="week-info-main">
                                <h2 id="visitesWeekTitle">üìÖ Semaine 51</h2>
                                <p id="visitesWeekPeriod">16 d√©cembre 2025 - 22 d√©cembre 2025</p>
                            </div>
                            <div class="visit-type-badge" id="visitTypeBadge">
                                <span>V2</span>
                                <small>Semaines 27-52</small>
                            </div>
                        </div>
                    </div>

                    <!-- Onglets SSI / DSF / Historique -->
                    <div class="visites-tabs">
                        <button class="visites-tab active" data-tab="ssi" onclick="switchVisitesTab('ssi')">
                            <span class="tab-icon">üîß</span>
                            <span class="tab-label">SSI</span>
                            <span class="tab-count" id="tabCountSSI">0</span>
                        </button>
                        <button class="visites-tab" data-tab="dsf" onclick="switchVisitesTab('dsf')">
                            <span class="tab-icon">üî•</span>
                            <span class="tab-label">DSF</span>
                            <span class="tab-count" id="tabCountDSF">0</span>
                        </button>
                        <button class="visites-tab" data-tab="historique" onclick="switchVisitesTab('historique')">
                            <span class="tab-icon">üìä</span>
                            <span class="tab-label">Historique</span>
                        </button>
                    </div>

                    <!-- Contenu SSI -->
                    <div id="visites-ssi" class="visites-content active">
                        
                        <!-- Stats SSI par secteur -->
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="icon">üìà</span>
                                R√©sum√© SSI par secteur - Semaine <span id="ssiWeekNum">51</span>
                            </h2>
                            <button class="btn-archive" onclick="archiveSSIWeek()">
                                <span>üíæ</span> Archiver cette semaine
                            </button>
                        </div>

                        <div class="sectors-stats-grid">
                            <!-- S1 -->
                            <div class="sector-stat-card s1">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s1">üîµ S1</span>
                                    <span class="sites-count"><span id="ssiStatS1Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="visit-row">
                                        <div class="visit-type">V1</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS1V1">0</span>
                                            <span class="visit-percent good" id="ssiStatS1V1Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS1V1Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="visit-row">
                                        <div class="visit-type">V2</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS1V2">0</span>
                                            <span class="visit-percent good" id="ssiStatS1V2Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS1V2Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- S2 -->
                            <div class="sector-stat-card s2">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s2">üü¢ S2</span>
                                    <span class="sites-count"><span id="ssiStatS2Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="visit-row">
                                        <div class="visit-type">V1</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS2V1">0</span>
                                            <span class="visit-percent good" id="ssiStatS2V1Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS2V1Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="visit-row">
                                        <div class="visit-type">V2</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS2V2">0</span>
                                            <span class="visit-percent good" id="ssiStatS2V2Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS2V2Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- S3 -->
                            <div class="sector-stat-card s3">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s3">üî¥ S3</span>
                                    <span class="sites-count"><span id="ssiStatS3Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="visit-row">
                                        <div class="visit-type">V1</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS3V1">0</span>
                                            <span class="visit-percent danger" id="ssiStatS3V1Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS3V1Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="visit-row">
                                        <div class="visit-type">V2</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatS3V2">0</span>
                                            <span class="visit-percent danger" id="ssiStatS3V2Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatS3V2Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Autres -->
                            <div class="sector-stat-card autres">
                                <div class="sector-stat-header">
                                    <span class="sector-badge autres">‚ö™ Autres</span>
                                    <span class="sites-count"><span id="ssiStatAutresSites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="visit-row">
                                        <div class="visit-type">V1</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatAutresV1">0</span>
                                            <span class="visit-percent" id="ssiStatAutresV1Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatAutresV1Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="visit-row">
                                        <div class="visit-type">V2</div>
                                        <div class="visit-data">
                                            <span class="visit-remaining" id="ssiStatAutresV2">0</span>
                                            <span class="visit-percent" id="ssiStatAutresV2Pct">0%</span>
                                        </div>
                                        <div class="progress-mini">
                                            <div class="progress-mini-fill" id="ssiStatAutresV2Bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tableaux historiques SSI -->
                        <div class="section-header" style="margin-top: 32px;">
                            <h2 class="section-title">
                                <span class="icon">üìã</span>
                                Historique Hebdomadaire SSI
                            </h2>
                        </div>

                        <div class="history-tables-grid">
                            <!-- Tableau S1 -->
                            <div class="history-table-card s1">
                                <div class="history-table-header s1">üîµ SECTEUR S1</div>
                                <div class="history-table-wrapper">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ssiHistoryS1"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tableau S2 -->
                            <div class="history-table-card s2">
                                <div class="history-table-header s2">üü¢ SECTEUR S2</div>
                                <div class="history-table-wrapper">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ssiHistoryS2"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tableau S3 -->
                            <div class="history-table-card s3">
                                <div class="history-table-header s3">üî¥ SECTEUR S3</div>
                                <div class="history-table-wrapper">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ssiHistoryS3"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tableau Autres -->
                            <div class="history-table-card autres">
                                <div class="history-table-header autres">‚ö™ AUTRES SECTEURS</div>
                                <div class="history-table-wrapper">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ssiHistoryAutres"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Contenu DSF -->
                    <div id="visites-dsf" class="visites-content">
                        
                        <!-- Stats DSF par secteur -->
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="icon">üî•</span>
                                R√©sum√© DSF par secteur - Semaine <span id="dsfWeekNum">51</span>
                            </h2>
                        </div>

                        <div class="sectors-stats-grid">
                            <!-- S1 DSF -->
                            <div class="sector-stat-card s1">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s1">üîµ S1</span>
                                    <span class="sites-count"><span id="dsfStatS1Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="dsf-stat-row">
                                        <div class="dsf-stat-main">
                                            <span class="dsf-remaining" id="dsfStatS1Rest">0</span>
                                            <span class="dsf-label">restantes</span>
                                        </div>
                                        <div class="dsf-progress-circle">
                                            <svg viewBox="0 0 40 40">
                                                <circle cx="20" cy="20" r="16" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="4"/>
                                                <circle id="dsfCircleS1" cx="20" cy="20" r="16" fill="none" stroke="var(--s1-color)" stroke-width="4" stroke-dasharray="100.53" stroke-dashoffset="100.53" stroke-linecap="round" transform="rotate(-90 20 20)"/>
                                            </svg>
                                            <span class="dsf-percent" id="dsfStatS1Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-mini">
                                        <div class="progress-mini-fill" id="dsfStatS1Bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- S2 DSF -->
                            <div class="sector-stat-card s2">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s2">üü¢ S2</span>
                                    <span class="sites-count"><span id="dsfStatS2Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="dsf-stat-row">
                                        <div class="dsf-stat-main">
                                            <span class="dsf-remaining" id="dsfStatS2Rest">0</span>
                                            <span class="dsf-label">restantes</span>
                                        </div>
                                        <div class="dsf-progress-circle">
                                            <svg viewBox="0 0 40 40">
                                                <circle cx="20" cy="20" r="16" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="4"/>
                                                <circle id="dsfCircleS2" cx="20" cy="20" r="16" fill="none" stroke="var(--s2-color)" stroke-width="4" stroke-dasharray="100.53" stroke-dashoffset="100.53" stroke-linecap="round" transform="rotate(-90 20 20)"/>
                                            </svg>
                                            <span class="dsf-percent" id="dsfStatS2Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-mini">
                                        <div class="progress-mini-fill" id="dsfStatS2Bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- S3 DSF -->
                            <div class="sector-stat-card s3">
                                <div class="sector-stat-header">
                                    <span class="sector-badge s3">üî¥ S3</span>
                                    <span class="sites-count"><span id="dsfStatS3Sites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="dsf-stat-row">
                                        <div class="dsf-stat-main">
                                            <span class="dsf-remaining" id="dsfStatS3Rest">0</span>
                                            <span class="dsf-label">restantes</span>
                                        </div>
                                        <div class="dsf-progress-circle">
                                            <svg viewBox="0 0 40 40">
                                                <circle cx="20" cy="20" r="16" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="4"/>
                                                <circle id="dsfCircleS3" cx="20" cy="20" r="16" fill="none" stroke="var(--s3-color)" stroke-width="4" stroke-dasharray="100.53" stroke-dashoffset="100.53" stroke-linecap="round" transform="rotate(-90 20 20)"/>
                                            </svg>
                                            <span class="dsf-percent" id="dsfStatS3Pct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-mini">
                                        <div class="progress-mini-fill" id="dsfStatS3Bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Autres DSF -->
                            <div class="sector-stat-card autres">
                                <div class="sector-stat-header">
                                    <span class="sector-badge autres">‚ö™ Autres</span>
                                    <span class="sites-count"><span id="dsfStatAutresSites">0</span> sites</span>
                                </div>
                                <div class="sector-stat-body">
                                    <div class="dsf-stat-row">
                                        <div class="dsf-stat-main">
                                            <span class="dsf-remaining" id="dsfStatAutresRest">0</span>
                                            <span class="dsf-label">restantes</span>
                                        </div>
                                        <div class="dsf-progress-circle">
                                            <svg viewBox="0 0 40 40">
                                                <circle cx="20" cy="20" r="16" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="4"/>
                                                <circle id="dsfCircleAutres" cx="20" cy="20" r="16" fill="none" stroke="var(--autres-color)" stroke-width="4" stroke-dasharray="100.53" stroke-dashoffset="100.53" stroke-linecap="round" transform="rotate(-90 20 20)"/>
                                            </svg>
                                            <span class="dsf-percent" id="dsfStatAutresPct">0%</span>
                                        </div>
                                    </div>
                                    <div class="progress-mini">
                                        <div class="progress-mini-fill" id="dsfStatAutresBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Planning mensuel DSF -->
                        <div class="section-header" style="margin-top: 32px;">
                            <h2 class="section-title">
                                <span class="icon">üìÖ</span>
                                Planning Mensuel DSF
                            </h2>
                            <div class="filter-dropdown">
                                <label>Secteur :</label>
                                <select id="dsfSectorFilter" onchange="filterDSFPlanning(this.value)">
                                    <option value="all">Tous les secteurs</option>
                                    <option value="s1">Secteur S1</option>
                                    <option value="s2">Secteur S2</option>
                                    <option value="s3">Secteur S3</option>
                                    <option value="autres">Autres</option>
                                </select>
                            </div>
                        </div>

                        <div id="dsfPlanningContainer">
                            <!-- Les tableaux de planning seront g√©n√©r√©s dynamiquement -->
                            <div class="empty-state-mini" id="dsfPlanningEmpty">
                                <p>üìä Importez des donn√©es DSF pour voir le planning mensuel</p>
                            </div>
                        </div>

                    </div>

                    <!-- Contenu Planning -->
                    <!-- Contenu Historique -->
                    <div id="visites-historique" class="visites-content">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="icon">üìä</span>
                                Historique des Visites
                            </h2>
                            <div class="historique-actions">
                                <input type="file" id="historiqueFileInput" accept=".xlsx,.xls" style="display:none;" onchange="VISITESMODULE.chargerHistorique(event)">
                                <button class="btn-secondary" onclick="document.getElementById('historiqueFileInput').click()">
                                    <span>üìÇ</span> Charger historique
                                </button>
                                <button class="btn-secondary" onclick="VISITESMODULE.ajouterSemaineHistorique()">
                                    <span>‚ûï</span> Ajouter semaine
                                </button>
                                <button class="btn-secondary" onclick="VISITESMODULE.exportHistorique()">
                                    <span>üì•</span> Exporter
                                </button>
                            </div>
                        </div>

                        <!-- Graphique historique -->
                        <div class="historique-chart-container">
                            <canvas id="historiqueChart"></canvas>
                        </div>

                        <!-- Tableau historique par semaine -->
                        <div class="historique-table-container">
                            <h3>üìÖ Progression par semaine</h3>
                            <div class="historique-grid">
                                <!-- S1 -->
                                <div class="historique-sector-card">
                                    <div class="historique-sector-header s1">üîµ Secteur S1</div>
                                    <table class="historique-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historiqueS1">
                                            <tr><td colspan="5" class="empty-cell">Aucun historique</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- S2 -->
                                <div class="historique-sector-card">
                                    <div class="historique-sector-header s2">üü¢ Secteur S2</div>
                                    <table class="historique-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historiqueS2">
                                            <tr><td colspan="5" class="empty-cell">Aucun historique</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- S3 -->
                                <div class="historique-sector-card">
                                    <div class="historique-sector-header s3">üî¥ Secteur S3</div>
                                    <table class="historique-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historiqueS3">
                                            <tr><td colspan="5" class="empty-cell">Aucun historique</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Autres -->
                                <div class="historique-sector-card">
                                    <div class="historique-sector-header autres">‚ö™ Autres</div>
                                    <table class="historique-table">
                                        <thead>
                                            <tr>
                                                <th>Semaine</th>
                                                <th>Type</th>
                                                <th>Restantes</th>
                                                <th>R√©alis√©es</th>
                                                <th>Objectif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historiqueAutres">
                                            <tr><td colspan="5" class="empty-cell">Aucun historique</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- MODAL STT - Fiche r√©capitulative -->
                <div id="modalSTT" class="modal-overlay" style="display: none;">
                    <div class="modal-container modal-stt">
                        <div class="modal-header">
                            <h2 id="modalSTTTitle">üìã Fiche STT</h2>
                            <button class="modal-close" onclick="VISITESMODULE.closeModalSTT()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <!-- Info STT -->
                            <div class="stt-info-card">
                                <div class="stt-info-row">
                                    <span class="stt-info-label">STT :</span>
                                    <span class="stt-info-value" id="modalSTTName">-</span>
                                </div>
                                <div class="stt-info-row">
                                    <span class="stt-info-label">Secteur :</span>
                                    <span class="stt-info-value" id="modalSTTSector">-</span>
                                </div>
                                <div class="stt-info-row">
                                    <span class="stt-info-label">Email :</span>
                                    <span class="stt-info-value email" id="modalSTTEmail">-</span>
                                </div>
                            </div>

                            <!-- Onglets Retard / √Ä Planifier -->
                            <div class="modal-stt-tabs">
                                <button class="modal-stt-tab retard active" onclick="VISITESMODULE.switchModalTab('retard')">
                                    ‚ö†Ô∏è En Retard <span class="modal-stt-tab-count" id="modalSTTRetardCount">0</span>
                                </button>
                                <button class="modal-stt-tab planifier" onclick="VISITESMODULE.switchModalTab('planifier')">
                                    üìÖ √Ä Planifier <span class="modal-stt-tab-count" id="modalSTTPlanifierCount">0</span>
                                </button>
                            </div>

                            <!-- Contenu Retard -->
                            <div id="modalSTTContentRetard" class="modal-stt-content active">
                                <!-- Historique RETARD -->
                                <div class="mail-history-card" style="background: rgba(239, 68, 68, 0.08); border-left: 4px solid var(--danger);">
                                    <h4 style="color: var(--danger);">‚ö†Ô∏è Historique Relances RETARD</h4>
                                    <div class="mail-dates">
                                        <div class="mail-date-row">
                                            <span class="mail-date-label">Dernier envoi :</span>
                                            <span class="mail-date-value" id="modalSTTLastSentRetard">Non enregistr√©</span>
                                        </div>
                                        <div class="mail-date-row">
                                            <span class="mail-date-label">Avant-dernier :</span>
                                            <span class="mail-date-value" id="modalSTTSecondLastSentRetard">Non enregistr√©</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Boutons RETARD en haut -->
                                <div class="modal-footer" style="margin-bottom: 16px; justify-content: flex-start;">
                                    <button class="btn-primary" onclick="VISITESMODULE.generateMailSTT('retard')" style="background: var(--danger);">
                                        <span>‚úâÔ∏è</span> Mail Relance RETARD
                                    </button>
                                    <button class="btn-success" onclick="VISITESMODULE.archiveMailDate('retard')">
                                        <span>üíæ</span> Archiver Date RETARD
                                    </button>
                                </div>
                                <div class="sites-table-container">
                                    <table class="sites-retard-table">
                                        <thead>
                                            <tr>
                                                <th>Num. Client</th>
                                                <th>Nom du Site</th>
                                                <th>Ville</th>
                                                <th>Mois Pr√©vu</th>
                                            </tr>
                                        </thead>
                                        <tbody id="modalSTTSitesRetardBody">
                                            <!-- G√©n√©r√© dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Contenu √Ä Planifier -->
                            <div id="modalSTTContentPlanifier" class="modal-stt-content">
                                <!-- Historique PLANIFIER -->
                                <div class="mail-history-card" style="background: rgba(14, 165, 233, 0.08); border-left: 4px solid var(--info);">
                                    <h4 style="color: var(--info);">üìÖ Historique Rappels √Ä PLANIFIER</h4>
                                    <div class="mail-dates">
                                        <div class="mail-date-row">
                                            <span class="mail-date-label">Dernier envoi :</span>
                                            <span class="mail-date-value" id="modalSTTLastSentPlanifier">Non enregistr√©</span>
                                        </div>
                                        <div class="mail-date-row">
                                            <span class="mail-date-label">Avant-dernier :</span>
                                            <span class="mail-date-value" id="modalSTTSecondLastSentPlanifier">Non enregistr√©</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Boutons PLANIFIER en haut -->
                                <div class="modal-footer" style="margin-bottom: 16px; justify-content: flex-start;">
                                    <button class="btn-primary" onclick="VISITESMODULE.generateMailSTT('planifier')" style="background: var(--info);">
                                        <span>‚úâÔ∏è</span> Mail Rappel √Ä PLANIFIER
                                    </button>
                                    <button class="btn-success" onclick="VISITESMODULE.archiveMailDate('planifier')">
                                        <span>üíæ</span> Archiver Date RAPPEL
                                    </button>
                                </div>
                                <div class="sites-table-container">
                                    <table class="sites-retard-table">
                                        <thead>
                                            <tr>
                                                <th>Num. Client</th>
                                                <th>Nom du Site</th>
                                                <th>Ville</th>
                                                <th>Mois Pr√©vu</th>
                                            </tr>
                                        </thead>
                                        <tbody id="modalSTTSitesPlanifierBody">
                                            <!-- G√©n√©r√© dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Message status -->
                            <div class="mail-status" id="modalSTTStatus"></div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="VISITESMODULE.closeModalSTT()">
                                Fermer
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ============================================
                     PAGE: DSF (Module complet)
                     ============================================ -->
                <div id="page-dsf" class="page">
                    
                    <!-- Onglets DSF -->
                    <div class="dsf-tabs">
                        <button class="dsf-tab-btn active" data-tab="cloture" onclick="DSF.switchTab('cloture')">
                            <span>üìã</span> √Ä Cl√¥turer
                            <span class="tab-badge" id="dsfBadgeCloture">0</span>
                        </button>
                        <button class="dsf-tab-btn" data-tab="planif" onclick="DSF.switchTab('planif')">
                            <span>üìÖ</span> √Ä Planifier
                            <span class="tab-badge" id="dsfBadgePlanif">0</span>
                        </button>
                        <button class="dsf-tab-btn" data-tab="resp" onclick="DSF.switchTab('resp')">
                            <span>‚ö†Ô∏è</span> RESP √† traiter
                            <span class="tab-badge danger" id="dsfBadgeResp">0</span>
                        </button>
                    </div>

                    <!-- Contenu DSF -->
                    <div class="dsf-content">
                        <div class="dsf-table-container">
                            <div class="table-actions">
                                <div class="filter-inline">
                                    <label>Secteur:</label>
                                    <select id="dsfSectorFilterTable" onchange="DSF.applyFilter()">
                                        <option value="TOUS">Tous</option>
                                        <option value="S1">S1</option>
                                        <option value="S2">S2</option>
                                        <option value="S3">S3</option>
                                        <option value="AUTRES">Autres</option>
                                    </select>
                                </div>
                                <span class="result-count" id="dsfResultCount">0 √©l√©ments</span>
                            </div>
                            <div class="table-wrapper">
                                <table class="dsf-table" id="dsfTable">
                                    <thead id="dsfTableHead"></thead>
                                    <tbody id="dsfTrackerTableBody"></tbody>
                                </table>
                            </div>
                            <div class="empty-state-dsf" id="dsfEmptyState">
                                <div class="empty-icon">üìà</div>
                                <h3>Aucune donn√©e DSF</h3>
                                <p>Importez un fichier avec les feuilles DSF CLOTURE, DSF PLANIF, DSF RESP</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Modal D√©tail DSF -->
                <div id="dsfDetailModal" class="modal-overlay">
                    <div class="modal-container">
                        <button class="modal-close" onclick="DSF.closeDetail()">√ó</button>
                        <h2 class="modal-title" id="dsfDetailModalTitle">üìà D√©tail DSF</h2>
                        <div class="modal-body" id="dsfDetailContent"></div>
                        <div class="modal-footer">
                            <button class="btn-action primary" onclick="DSF.markAsProcessed()">‚úÖ Marquer comme trait√©</button>
                        </div>
                    </div>
                </div>

                <!-- ============================================
                     PAGE: SEARCH SSI (Module complet)
                     ============================================ -->
                <div id="page-searchssi" class="page">

                    <!-- Filtres -->
                    <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 24px; border: 1px solid var(--border-subtle);">
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 16px;">
                            <div>
                                <label style="display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; text-transform: uppercase;">Code</label>
                                <input type="text" id="ssiSearchCode" placeholder="Rechercher..." style="width: 100%; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; text-transform: uppercase;">Nom</label>
                                <input type="text" id="ssiSearchNom" placeholder="Rechercher..." style="width: 100%; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; text-transform: uppercase;">Ville</label>
                                <input type="text" id="ssiSearchVille" placeholder="Rechercher..." style="width: 100%; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; text-transform: uppercase;">Secteur</label>
                                <select id="ssiSearchSecteur" style="width: 100%; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit;">
                                    <option value="">TOUS</option>
                                    <option value="S1">S1</option>
                                    <option value="S2">S2</option>
                                    <option value="S3">S3</option>
                                    <option value="AUTRES">AUTRES</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; text-transform: uppercase;">D√©partement</label>
                                <input type="text" id="ssiSearchDept" placeholder="Rechercher..." style="width: 100%; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                            <button id="ssiFilterV1" onclick="SEARCHSSI.toggleFilter('v1')" style="padding: 10px 20px; background: var(--bg-elevated); border: 2px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-secondary); font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit;">üìÖ V1 RESTANT</button>
                            <button id="ssiFilterV2" onclick="SEARCHSSI.toggleFilter('v2')" style="padding: 10px 20px; background: var(--bg-elevated); border: 2px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-secondary); font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit;">üìÖ V2 RESTANT</button>
                            <span id="ssiFilterCounter" style="display: none; background: var(--primary); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9em;">Visites restantes: <span id="ssiCounterValue">0</span></span>
                            <button onclick="SEARCHSSI.reset()" style="margin-left: auto; padding: 10px 20px; background: var(--danger); border: none; border-radius: var(--radius-md); color: white; font-weight: 600; cursor: pointer; font-family: inherit;">üîÑ R√©initialiser</button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Heures Seul</div>
                            <div id="ssiHeuresSeul" style="font-size: 2em; font-weight: 800; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Heures Bin√¥me</div>
                            <div id="ssiHeuresBinome" style="font-size: 2em; font-weight: 800; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Total Heures</div>
                            <div id="ssiTotalHeures" style="font-size: 2em; font-weight: 800; color: var(--primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Sites Total</div>
                            <div id="ssiSitesTotal" style="font-size: 2em; font-weight: 800; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Sites Seul</div>
                            <div id="ssiSitesSeul" style="font-size: 2em; font-weight: 800; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); text-align: center;">
                            <div style="font-size: 0.85em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Sites Binome</div>
                            <div id="ssiSitesBinome" style="font-size: 2em; font-weight: 800; color: var(--text-primary); font-family: 'JetBrains Mono', monospace;">0</div>
                        </div>
                    </div>

                    <!-- Techniciens par secteur -->
                    <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); margin-bottom: 24px;">
                        <h3 style="color: var(--text-primary); margin-bottom: 16px;">üë®‚Äçüîß Techniciens par Secteur</h3>
                        <div id="ssiTechBySector" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                            <div>
                                <div style="background: linear-gradient(135deg, var(--s1-color) 0%, var(--s1-dark) 100%); color: white; padding: 12px; border-radius: var(--radius-md); text-align: center; font-weight: 700; margin-bottom: 12px;">S1</div>
                                <div id="ssiTechS1" style="display: flex; flex-direction: column; gap: 8px;"></div>
                            </div>
                            <div>
                                <div style="background: linear-gradient(135deg, var(--s2-color) 0%, var(--s2-dark) 100%); color: white; padding: 12px; border-radius: var(--radius-md); text-align: center; font-weight: 700; margin-bottom: 12px;">S2</div>
                                <div id="ssiTechS2" style="display: flex; flex-direction: column; gap: 8px;"></div>
                            </div>
                            <div>
                                <div style="background: linear-gradient(135deg, var(--s3-color) 0%, var(--s3-dark) 100%); color: white; padding: 12px; border-radius: var(--radius-md); text-align: center; font-weight: 700; margin-bottom: 12px;">S3</div>
                                <div id="ssiTechS3" style="display: flex; flex-direction: column; gap: 8px;"></div>
                            </div>
                            <div>
                                <div style="background: linear-gradient(135deg, var(--autres-color) 0%, var(--autres-dark) 100%); color: white; padding: 12px; border-radius: var(--radius-md); text-align: center; font-weight: 700; margin-bottom: 12px;">AUTRES</div>
                                <div id="ssiTechAutres" style="display: flex; flex-direction: column; gap: 8px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Table des r√©sultats -->
                    <div style="background: var(--bg-card); border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); overflow: hidden;">
                        <div style="max-height: 500px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); position: sticky; top: 0; z-index: 10;">
                                    <tr>
                                        <th onclick="ssiSortTable('tech')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; position: relative;">
                                            TECH <span id="ssiSortTech"></span>
                                            <div id="ssiTechFilterDropdown" style="display:none;position:absolute;top:100%;left:0;background:#fff;border:2px solid #667eea;border-radius:8px;padding:15px;min-width:250px;max-height:400px;overflow-y:auto;z-index:100;box-shadow:0 5px 20px rgba(0,0,0,.3)">
                                                <div style="margin-bottom:10px;padding-bottom:10px;border-bottom:2px solid #e9ecef">
                                                    <button onclick="ssiSelectAllTech()" style="padding:8px 15px;background:#667eea;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;margin-right:5px">Tous</button>
                                                    <button onclick="ssiDeselectAllTech()" style="padding:8px 15px;background:#dc3545;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600">Aucun</button>
                                                </div>
                                                <div id="ssiTechCheckboxList"></div>
                                            </div>
                                            <button id="ssiTechFilterBtn" onclick="ssiToggleTechFilter(event)" style="position:absolute;right:5px;top:50%;transform:translateY(-50%);background:#667eea;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-weight:600;font-size:0.8em">‚ñº</button>
                                        </th>
                                        <th onclick="ssiSortTable('nom')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">NOM <span id="ssiSortNom"></span></th>
                                        <th onclick="ssiSortTable('ville')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">VILLE <span id="ssiSortVille"></span></th>
                                        <th onclick="ssiSortTable('code')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">CODE <span id="ssiSortCode"></span></th>
                                        <th onclick="ssiSortTable('site')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">SITE <span id="ssiSortSite"></span></th>
                                        <th onclick="ssiSortTable('dept')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">DEPT <span id="ssiSortDept"></span></th>
                                        <th onclick="ssiSortTable('nbVisite')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">VISITE <span id="ssiSortNbVisite"></span></th>
                                        <th onclick="ssiSortTable('nbHeure')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">HEURE <span id="ssiSortNbHeure"></span></th>
                                        <th onclick="ssiSortTable('techBinomeAffich')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">BINOME <span id="ssiSortTechBinomeAffich"></span></th>
                                        <th onclick="ssiSortTable('bk')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">V0 MAX <span id="ssiSortBk"></span></th>
                                        <th onclick="ssiSortTable('bt')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">PL1 <span id="ssiSortBt"></span></th>
                                        <th onclick="ssiSortTable('bp')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">V1 <span id="ssiSortBp"></span></th>
                                        <th onclick="ssiSortTable('bv')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">PL2 <span id="ssiSortBv"></span></th>
                                        <th onclick="ssiSortTable('bq')" style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase; cursor: pointer;">V2 <span id="ssiSortBq"></span></th>
                                        <th style="padding: 14px 12px; text-align: left; color: white; font-size: 0.8em; text-transform: uppercase;">#</th>
                                    </tr>
                                </thead>
                                <tbody id="ssiSearchTableBody">
                                    <tr><td colspan="15" style="text-align: center; padding: 40px; color: var(--text-muted);">üìã Chargez un fichier Excel avec la feuille SSI</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>

                <!-- Modal Site SSI -->
                <div id="ssiSiteModal" class="modal-overlay">
                    <div class="modal-container" style="max-width:98vw;width:98vw;height:auto;max-height:98vh;overflow:hidden;padding:5px 10px;margin:auto;position:relative;">
                        <button class="modal-close" onclick="SEARCHSSI.closeModal()">√ó</button>
                        <!-- Fl√®ches navigation -->
                        <button id="ssiPrevBtn" onclick="SEARCHSSI.prev()" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:50%;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-size:20px;cursor:pointer;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,0.2);">‚óÄ</button>
                        <button id="ssiNextBtn" onclick="SEARCHSSI.next()" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:50%;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-size:20px;cursor:pointer;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,0.2);">‚ñ∂</button>
                        <h2 class="modal-title" id="ssiModalTitle" style="padding:3px 8px;font-size:0.9em;margin:0 50px;border-bottom:none;">üè¢ Fiche Site SSI</h2>
                        <div class="modal-body" id="ssiModalBody" style="padding:1px 0px;"></div>
                    </div>
                </div>

                <!-- Modal DSF Cl√¥ture/Planif/Resp avec filtres Mois + STT + Relance Mail -->
                <div id="dsfModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;justify-content:center;align-items:center;">
                    <div style="background:var(--bg-card);border-radius:20px;width:95%;max-width:1200px;max-height:90vh;display:flex;flex-direction:column;box-shadow:0 25px 80px rgba(0,0,0,0.3);">
                        <!-- Header -->
                        <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px 25px;display:flex;justify-content:space-between;align-items:center;border-radius:20px 20px 0 0;flex-shrink:0;">
                            <div style="display:flex;align-items:center;gap:15px;">
                                <h2 id="dsfModalTitle" style="color:white;margin:0;font-size:1.4em;font-weight:700;">üìã DSF</h2>
                                <span id="dsfModalCount" style="background:rgba(255,255,255,0.2);color:white;padding:6px 14px;border-radius:20px;font-weight:600;font-size:0.9em;">0 sites</span>
                            </div>
                            <button onclick="closeDSFModal()" style="color:white;background:rgba(255,255,255,0.15);border:none;font-size:24px;cursor:pointer;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;">√ó</button>
                        </div>
                        <!-- Body avec scroll -->
                        <div style="padding:20px;overflow-y:auto;flex:1;background:var(--bg-secondary);">
                            <!-- Filtre Mois -->
                            <div style="background:var(--bg-card);border-radius:12px;padding:15px;margin-bottom:15px;border:1px solid var(--border-subtle);">
                                <div style="font-weight:700;color:var(--text-secondary);margin-bottom:12px;font-size:0.9em;">üìÖ FILTRER PAR MOIS</div>
                                <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                                    <button class="dsf-flt-btn active" data-mois="ALL" onclick="filterDSFMois('ALL')">Tous <span class="dsf-flt-cnt" id="dsfMoisAll">0</span></button>
                                    <span id="dsfMoisContainer" style="display:contents;"></span>
                                </div>
                            </div>
                            <!-- Filtre STT -->
                            <div style="background:var(--bg-card);border-radius:12px;padding:15px;margin-bottom:15px;border:1px solid var(--border-subtle);">
                                <div style="font-weight:700;color:var(--text-secondary);margin-bottom:12px;font-size:0.9em;">üë∑ FILTRER PAR SOUS-TRAITANT</div>
                                <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                                    <button class="dsf-flt-btn active" data-stt="ALL" onclick="filterDSFStt('ALL')">Tous <span class="dsf-flt-cnt" id="dsfSttAll">0</span></button>
                                    <span id="dsfSttContainer" style="display:contents;"></span>
                                </div>
                            </div>
                            <!-- Bouton Relance Mail -->
                            <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;padding:15px;background:var(--bg-card);border-radius:12px;border:1px solid var(--border-subtle);">
                                <button onclick="sendDSFRelance()" style="background:linear-gradient(135deg,#ef4444,#dc2626);color:white;border:none;padding:12px 24px;border-radius:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:0.95em;box-shadow:0 4px 15px rgba(239,68,68,0.3);">
                                    ‚úâÔ∏è Envoyer Relance STT
                                </button>
                                <span id="dsfMailStatus" style="color:var(--text-muted);font-size:0.9em;font-weight:500;"></span>
                            </div>
                            <!-- Tableau -->
                            <div style="background:var(--bg-card);border-radius:12px;border:1px solid var(--border-subtle);overflow:hidden;">
                                <table style="width:100%;border-collapse:collapse;">
                                    <thead>
                                        <tr style="background:linear-gradient(135deg,#667eea,#764ba2);">
                                            <th class="dsf-sortable" data-col="numClient" onclick="sortDSFTable('numClient')" style="padding:14px 12px;text-align:left;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                N¬∞ CLIENT <span class="sort-icon" id="sort-numClient">‚áÖ</span>
                                            </th>
                                            <th class="dsf-sortable" data-col="nomSite" onclick="sortDSFTable('nomSite')" style="padding:14px 12px;text-align:left;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                NOM SITE <span class="sort-icon" id="sort-nomSite">‚áÖ</span>
                                            </th>
                                            <th class="dsf-sortable" data-col="ville" onclick="sortDSFTable('ville')" style="padding:14px 12px;text-align:left;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                VILLE <span class="sort-icon" id="sort-ville">‚áÖ</span>
                                            </th>
                                            <th class="dsf-sortable" data-col="moisSTT" onclick="sortDSFTable('moisSTT')" style="padding:14px 12px;text-align:center;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                MOIS <span class="sort-icon" id="sort-moisSTT">‚áÖ</span>
                                            </th>
                                            <th class="dsf-sortable" data-col="stt" onclick="sortDSFTable('stt')" style="padding:14px 12px;text-align:left;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                STT <span class="sort-icon" id="sort-stt">‚áÖ</span>
                                            </th>
                                            <th class="dsf-sortable" data-col="secteur" onclick="sortDSFTable('secteur')" style="padding:14px 12px;text-align:left;color:white;font-weight:600;font-size:0.85em;cursor:pointer;user-select:none;">
                                                SECTEUR <span class="sort-icon" id="sort-secteur">‚áÖ</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="dsfTableBody">
                                        <tr><td colspan="6" style="text-align:center;padding:30px;color:var(--text-muted);">Chargement...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <style>
                    .dsf-flt-btn {
                        padding: 8px 16px;
                        border: 2px solid var(--border-color);
                        background: var(--bg-card);
                        color: var(--text-primary);
                        border-radius: 25px;
                        cursor: pointer;
                        font-weight: 600;
                        font-size: 0.85em;
                        transition: all 0.2s;
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .dsf-flt-btn:hover {
                        border-color: #667eea;
                        background: rgba(102,126,234,0.1);
                    }
                    .dsf-flt-btn.active {
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border-color: transparent;
                        box-shadow: 0 4px 15px rgba(102,126,234,0.4);
                    }
                    .dsf-flt-cnt {
                        background: rgba(0,0,0,0.1);
                        padding: 2px 10px;
                        border-radius: 12px;
                        font-size: 0.85em;
                        min-width: 20px;
                        text-align: center;
                    }
                    .dsf-flt-btn.active .dsf-flt-cnt {
                        background: rgba(255,255,255,0.25);
                    }
                    #dsfTableBody tr {
                        border-bottom: 1px solid var(--border-subtle);
                    }
                    #dsfTableBody tr:hover {
                        background: rgba(102,126,234,0.06);
                    }
                    .dsf-mini-stat.clickable {
                        cursor: pointer;
                        transition: all 0.3s;
                    }
                    .dsf-mini-stat.clickable:hover {
                        transform: scale(1.08);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    }
                    .dsf-sortable {
                        transition: background 0.2s;
                    }
                    .dsf-sortable:hover {
                        background: rgba(255,255,255,0.1);
                    }
                    .sort-icon {
                        margin-left: 5px;
                        font-size: 0.9em;
                        opacity: 0.7;
                    }
                    .sort-icon.asc::after {
                        content: '‚Üë';
                    }
                    .sort-icon.desc::after {
                        content: '‚Üì';
                    }
                </style>

                <!-- MODALE TRAVAUX RESTANTS (PL TECH vide) -->
                <div id="travauxRestantsModal" class="modal-overlay" style="display:none;">
                    <div class="modal-container" style="max-width:95vw;width:1200px;max-height:90vh;overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#f59e0b,#d97706);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;">
                            <h2 id="travauxRestantsTitle" style="color:white;margin:0;">üîß Travaux Restants</h2>
                            <button onclick="closeTravauxRestantsModal()" style="color:white;background:none;border:none;font-size:24px;cursor:pointer;">√ó</button>
                        </div>
                        <div style="padding:15px;overflow-y:auto;max-height:calc(90vh - 80px);">
                            <div style="margin-bottom:15px;padding:10px;background:var(--bg-tertiary);border-radius:10px;">
                                <span style="font-weight:600;color:var(--text-muted);">üìä Total: </span>
                                <span id="travauxRestantsCount" style="font-weight:700;color:#f59e0b;">0</span>
                                <span style="color:var(--text-muted);"> travaux avec PL TECH vide</span>
                            </div>
                            <div style="overflow-x:auto;">
                                <table style="width:100%;border-collapse:collapse;">
                                    <thead><tr style="background:linear-gradient(135deg,#f59e0b,#d97706);color:white;">
                                        <th style="padding:10px;text-align:left;">N¬∞ Client</th>
                                        <th style="padding:10px;text-align:left;">N¬∞ Devis</th>
                                        <th style="padding:10px;text-align:left;">Soci√©t√©</th>
                                        <th style="padding:10px;text-align:left;">Objet</th>
                                        <th style="padding:10px;text-align:left;">Technicien</th>
                                        <th style="padding:10px;text-align:left;">STT</th>
                                        <th style="padding:10px;text-align:left;">Secteur</th>
                                    </tr></thead>
                                    <tbody id="travauxRestantsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <style>
                    #travauxRestantsTableBody tr{border-bottom:1px solid var(--border-color);transition:background 0.2s;}
                    #travauxRestantsTableBody tr:hover{background:rgba(245,158,11,0.08);}
                    #travauxRestantsTableBody td{padding:10px;}
                </style>

                <!-- ============================================
                     PAGE: PRODUITS (Module complet)
                     ============================================ -->
                <div id="page-produits" class="page">
                    
                    <!-- STYLES pour Recherche R√©f Produit -->
                    <style>
                        .produit-upload-zone {
                            background: rgba(255, 255, 255, 0.95);
                            border-radius: 15px;
                            padding: 50px 30px;
                            text-align: center;
                            border: 3px dashed #667eea;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            margin-bottom: 20px;
                        }
                        .produit-upload-zone:hover { transform: translateY(-3px); border-color: #764ba2; }
                        .produit-search-container { display: none; }
                        .produit-search-box { background: white; border-radius: 12px; padding: 12px; margin-bottom: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
                        .produit-search-input { width: 100%; padding: 10px 10px 10px 38px; font-size: 0.9em; border: 2px solid #e0e0e0; border-radius: 8px; outline: none; }
                        .produit-search-input:focus { border-color: #667eea; }
                        .produit-controls-row { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
                        .produit-year-btn { padding: 6px 16px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 16px; cursor: pointer; font-weight: 600; }
                        .produit-year-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
                        .produit-results-info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border-radius: 12px; margin-bottom: 15px; display: none; align-items: center; gap: 8px; }
                        .produit-table { width: 100%; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
                        .produit-table thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
                        .produit-table th { padding: 12px 15px; text-align: left; font-weight: 600; }
                        .produit-table td { padding: 10px 15px; border-bottom: 1px solid #f0f0f0; }
                        .produit-table tbody tr:hover { background: rgba(102, 126, 234, 0.08); }
                        .produit-copy-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; }
                        .produit-copy-btn.copied { background: #10b981; }
                    </style>

                    <!-- Zone Upload -->
                    <div class="produit-upload-zone" id="produitUploadZone" onclick="document.getElementById('produitFileInput').click()" ondragover="event.preventDefault()" ondrop="event.preventDefault(); handleProduitFile(event.dataTransfer.files[0])">
                        <div style="font-size: 4em; color: #667eea; margin-bottom: 15px;">üìÅ</div>
                        <h2 style="color: #333; margin-bottom: 8px;">Importer le fichier Produits</h2>
                        <p style="color: #666;">Glissez-d√©posez ou cliquez pour s√©lectionner un fichier Excel</p>
                    </div>
                    <input type="file" id="produitFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleProduitFile(this.files[0]); this.value=''">

                    <!-- Container Recherche -->
                    <div class="produit-search-container" id="produitSearchContainer">
                        <div class="produit-search-box">
                            <div style="position: relative;">
                                <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #667eea;">üîç</span>
                                <input type="text" id="produitSearchInput" class="produit-search-input" placeholder="Rechercher par code, nom ou description..." oninput="performProduitSearch()">
                            </div>
                            <div class="produit-controls-row">
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <label style="font-weight: 600;">Ann√©e :</label>
                                    <div id="produitYearButtons"></div>
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center; flex: 1;">
                                    <label style="font-weight: 600; color: #667eea;">üìÅ Cat√©gorie :</label>
                                    <select id="produitCategoryFilter" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="produitSelectedCategory=this.value; performProduitSearch()">
                                        <option value="">Toutes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="produit-results-info" id="produitResultsInfo">
                            <span>üìä</span>
                            <span id="produitResultsCount">0 produits</span>
                        </div>
                        <div style="max-height: 60vh; overflow-y: auto; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                            <table class="produit-table">
                                <thead>
                                    <tr>
                                        <th>Copier</th>
                                        <th>Code</th>
                                        <th>Nom</th>
                                        <th>Description</th>
                                        <th>Prix Public</th>
                                        <th>Prix Util</th>
                                        <th>Prix Install</th>
                                    </tr>
                                </thead>
                                <tbody id="produitResultsBody"></tbody>
                            </table>
                        </div>
                    </div>

                </div>

                <!-- ============================================
                     PAGE: SAV (Service Apr√®s-Vente)
                     ============================================ -->
                <div id="page-sav" class="page">
                    
                    <!-- Stats globales (cliquables) -->
                    <div class="sav-stats-bar">
                        <div class="sav-stat-item clickable" onclick="SAV.openModal('total', 'TOUS')">
                            <div>
                                <div class="stat-value" id="savStatTotal">0</div>
                                <div class="stat-label">Total du jour</div>
                            </div>
                        </div>
                        <div class="sav-stat-item urgents clickable" onclick="SAV.openModal('urgents', 'TOUS')">
                            <div>
                                <div class="stat-value" id="savStatUrgents">0</div>
                                <div class="stat-label">üî¥ Urgents</div>
                            </div>
                        </div>
                        <div class="sav-stat-item moyens clickable" onclick="SAV.openModal('moyens', 'TOUS')">
                            <div>
                                <div class="stat-value" id="savStatMoyens">0</div>
                                <div class="stat-label">üü† 48H</div>
                            </div>
                        </div>
                        <div class="sav-stat-item rdv clickable" onclick="SAV.openModal('rdv', 'TOUS')">
                            <div>
                                <div class="stat-value" id="savStatRdv">0</div>
                                <div class="stat-label">üü¢ RDV</div>
                            </div>
                        </div>
                        <div class="sav-stat-item clickable" onclick="SAV.openModal('nonPlanifies', 'TOUS')">
                            <div>
                                <div class="stat-value" id="savStatNonPlanifies">0</div>
                                <div class="stat-label">‚ö™ Non planifi√©s</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPIs d√©taill√©s par secteur -->
                    <div class="sav-kpi-detail-container">
                        <div class="kpi-detail-title">üìä D√©tail par secteur aujourd'hui</div>
                        <div id="savKpiSecteursDetail">
                            <!-- G√©n√©r√© par JS -->
                        </div>
                    </div>

                    <!-- Onglets -->
                    <div class="sav-tabs">
                        <button class="sav-tab active" data-tab="encours" onclick="SAV.switchTab('encours')">
                            üìã SAV du jour
                        </button>
                        <button class="sav-tab" data-tab="kpis" onclick="SAV.switchTab('kpis')">
                            üìä KPIs Semaine
                        </button>
                    </div>

                    <!-- Contenu: SAV du jour (g√©n√©r√© par JS) -->
                    <div id="sav-encours" class="sav-content active">
                        <!-- Contenu g√©n√©r√© dynamiquement par SAV.renderSAVEnCours() -->
                    </div>

                    <!-- Contenu: KPIs Semaine (g√©n√©r√© par JS) -->
                    <div id="sav-kpis" class="sav-content">
                        <!-- Contenu g√©n√©r√© dynamiquement par SAV.renderKPIs() -->
                    </div>

                </div>

                <!-- ============================================
                     PAGE: ARCHIVES
                     ============================================ -->
                <div id="page-archives" class="page">
                    
                    <div class="archives-header">
                        <h2>üóÑÔ∏è Archives & Historique</h2>
                        <p>Consultez l'historique de vos donn√©es</p>
                    </div>

                    <!-- Types d'archives -->
                    <div class="archives-grid">
                        <div class="archive-card">
                            <div class="archive-icon">üìÖ</div>
                            <h3>Archives SSI</h3>
                            <p>Historique hebdomadaire des visites SSI</p>
                            <button class="btn-archive-action" onclick="ARCHIVES.exportSSI()">üì• Exporter</button>
                        </div>
                        <div class="archive-card">
                            <div class="archive-icon">üìä</div>
                            <h3>Archives Travaux</h3>
                            <p>Historique des travaux trait√©s</p>
                            <button class="btn-archive-action" onclick="ARCHIVES.exportTravaux()">üì• Exporter</button>
                        </div>
                        <div class="archive-card">
                            <div class="archive-icon">üìß</div>
                            <h3>Historique Emails</h3>
                            <p>Log des emails envoy√©s</p>
                            <button class="btn-archive-action" onclick="ARCHIVES.viewEmails()">üëÅÔ∏è Consulter</button>
                        </div>
                    </div>

                    <!-- Actions de maintenance -->
                    <div class="maintenance-section">
                        <h3>üîß Maintenance</h3>
                        <div class="maintenance-actions">
                            <button class="btn-maintenance" onclick="ARCHIVES.clearCache()">üóëÔ∏è Vider le cache</button>
                            <button class="btn-maintenance" onclick="ARCHIVES.exportAll()">üì¶ Exporter tout</button>
                            <button class="btn-maintenance danger" onclick="ARCHIVES.resetAll()">‚ö†Ô∏è R√©initialiser</button>
                        </div>
                    </div>

                </div>

            </div>
        </main>
    </div>

    <!-- Input file cach√© -->
    <input type="file" id="fileInput" accept=".xlsx,.xls">

    <!-- ============================================
         JAVASCRIPT
         ============================================ -->

    <!-- Libraries externes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- ========================================
         GESTION PRO - Modules JavaScript
         ORDRE DE CHARGEMENT IMPORTANT !
         ======================================== -->
    
    <!-- 1. CORE - Configuration et utilitaires -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/parser.js"></script>
    
    <!-- 2. MODULES - Chaque module m√©tier -->
    <script src="js/dashboard.js"></script>
    <script src="js/visites.js"></script>
    <script src="js/travaux.js"></script>
    <script src="js/devis.js"></script>
    <script src="js/dsf.js"></script>
    <script src="js/searchssi.js"></script>
    <script src="js/produits.js"></script>
    <script src="js/sav.js"></script>
    
    <!-- 3. INIT - Point d'entr√©e (TOUJOURS EN DERNIER) -->
    <script src="js/app.js"></script>
    
    <!-- 4. Bridge Access (optionnel) -->
    <script src="bridge/bridge.js"></script>
</body>
</html>
